# Exchange Web 快速上手

## 概述

這是一個最小化的交易所前端專案，使用最簡單的技術實現註冊、登入、下單、行情等基本功能。

**目標**：用最少的代碼快速驗證功能，適合前端新手上手。

## 技術選擇

選擇最簡單、文檔最豐富的技術：

```
React          - 最流行的 UI 框架
TypeScript     - 提供型別提示，減少錯誤
Vite           - 快速啟動的構建工具
Ant Design     - 現成的 UI 組件庫（不用自己寫樣式）
Axios          - HTTP 請求庫
```

## 快速開始

### 1. 創建專案

```bash
# 進入專案根目錄
cd /mnt/c/iProject/open.vincentf13

# 創建前端專案
mkdir -p web/exchange-web
cd web/exchange-web

# 使用 Vite 創建 React + TypeScript 專案
npm create vite@latest . -- --template react-ts

# 安裝依賴
npm install

# 安裝額外需要的庫
npm install axios antd react-router-dom
npm install @ant-design/icons  # Ant Design 圖標

# 啟動開發服務器
npm run dev
```

訪問 http://localhost:5173 就能看到頁面了！

### 2. 目錄結構（最簡化）

```
web/exchange-web/
├── src/
│   ├── api/              # API 調用
│   │   ├── client.ts     # Axios 配置
│   │   ├── auth.ts       # 登入 API
│   │   └── user.ts       # 使用者 API
│   ├── pages/            # 頁面
│   │   ├── Login.tsx     # 登入頁
│   │   ├── Register.tsx  # 註冊頁
│   │   ├── Trading.tsx   # 交易頁（下單+行情）
│   │   └── Orders.tsx    # 訂單列表
│   ├── App.tsx           # 主應用
│   ├── main.tsx          # 入口文件
│   └── vite-env.d.ts
├── .env                  # 環境變數
├── package.json
├── tsconfig.json
└── vite.config.ts
```

## 核心代碼實現

### 1. 配置 API 客戶端

**`src/api/client.ts`** - Axios 基礎配置

```typescript
import axios from 'axios';

const apiClient = axios.create({
  baseURL: 'http://localhost:12345',  // Gateway 地址
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// 請求攔截器：自動添加 Token
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('accessToken');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 響應攔截器：統一錯誤處理
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('accessToken');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

### 2. API 函數封裝

**`src/api/auth.ts`** - 認證相關 API

```typescript
import apiClient from './client';

// 登入
export const login = async (email: string, password: string) => {
  const response = await apiClient.post('/auth/api/login', {
    email,
    password,
  });
  return response.data;
};

// 註冊
export const register = async (email: string, password: string) => {
  const response = await apiClient.post('/user/api/user', {
    email,
    password,
    externalId: `user-${Date.now()}`,
  });
  return response.data;
};
```

**`src/api/user.ts`** - 使用者 API

```typescript
import apiClient from './client';

// 獲取當前使用者資訊
export const getCurrentUser = async () => {
  const response = await apiClient.get('/user/api/user/me');
  return response.data;
};
```

### 3. 登入頁面

**`src/pages/Login.tsx`**

```typescript
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Form, Input, Button, Card, message } from 'antd';
import { UserOutlined, LockOutlined } from '@ant-design/icons';
import { login } from '../api/auth';

export default function Login() {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  const handleLogin = async (values: { email: string; password: string }) => {
    setLoading(true);
    try {
      const result = await login(values.email, values.password);

      if (result.code === '0') {
        // 儲存 Token
        localStorage.setItem('accessToken', result.data.token);
        message.success('登入成功！');
        navigate('/trading');
      } else {
        message.error(result.message || '登入失敗');
      }
    } catch (error: any) {
      message.error(error.response?.data?.message || '登入失敗');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      minHeight: '100vh',
      background: '#f0f2f5'
    }}>
      <Card title="交易所登入" style={{ width: 400 }}>
        <Form onFinish={handleLogin}>
          <Form.Item
            name="email"
            rules={[{ required: true, message: '請輸入信箱' }]}
          >
            <Input
              prefix={<UserOutlined />}
              placeholder="信箱"
            />
          </Form.Item>

          <Form.Item
            name="password"
            rules={[{ required: true, message: '請輸入密碼' }]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="密碼"
            />
          </Form.Item>

          <Form.Item>
            <Button
              type="primary"
              htmlType="submit"
              loading={loading}
              block
            >
              登入
            </Button>
          </Form.Item>

          <Button type="link" onClick={() => navigate('/register')} block>
            沒有帳號？立即註冊
          </Button>
        </Form>
      </Card>
    </div>
  );
}
```

### 4. 註冊頁面

**`src/pages/Register.tsx`**

```typescript
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Form, Input, Button, Card, message } from 'antd';
import { UserOutlined, LockOutlined } from '@ant-design/icons';
import { register } from '../api/auth';

export default function Register() {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  const handleRegister = async (values: {
    email: string;
    password: string;
    confirm: string;
  }) => {
    if (values.password !== values.confirm) {
      message.error('兩次密碼輸入不一致');
      return;
    }

    setLoading(true);
    try {
      const result = await register(values.email, values.password);

      if (result.code === '0') {
        message.success('註冊成功！請登入');
        navigate('/login');
      } else {
        message.error(result.message || '註冊失敗');
      }
    } catch (error: any) {
      message.error(error.response?.data?.message || '註冊失敗');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      minHeight: '100vh',
      background: '#f0f2f5'
    }}>
      <Card title="註冊帳號" style={{ width: 400 }}>
        <Form onFinish={handleRegister}>
          <Form.Item
            name="email"
            rules={[
              { required: true, message: '請輸入信箱' },
              { type: 'email', message: '請輸入有效的信箱' }
            ]}
          >
            <Input
              prefix={<UserOutlined />}
              placeholder="信箱"
            />
          </Form.Item>

          <Form.Item
            name="password"
            rules={[
              { required: true, message: '請輸入密碼' },
              { min: 6, message: '密碼至少 6 位' }
            ]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="密碼"
            />
          </Form.Item>

          <Form.Item
            name="confirm"
            rules={[{ required: true, message: '請確認密碼' }]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="確認密碼"
            />
          </Form.Item>

          <Form.Item>
            <Button
              type="primary"
              htmlType="submit"
              loading={loading}
              block
            >
              註冊
            </Button>
          </Form.Item>

          <Button type="link" onClick={() => navigate('/login')} block>
            已有帳號？立即登入
          </Button>
        </Form>
      </Card>
    </div>
  );
}
```

### 5. 交易頁面（簡化版）

**`src/pages/Trading.tsx`**

```typescript
import { useState } from 'react';
import { Card, InputNumber, Button, Radio, Space, message, Statistic, Row, Col } from 'antd';

export default function Trading() {
  const [orderType, setOrderType] = useState<'LIMIT' | 'MARKET'>('LIMIT');
  const [side, setSide] = useState<'BUY' | 'SELL'>('BUY');
  const [price, setPrice] = useState<number>(0);
  const [quantity, setQuantity] = useState<number>(0);
  const [loading, setLoading] = useState(false);

  const handleSubmit = async () => {
    if (orderType === 'LIMIT' && !price) {
      message.error('請輸入價格');
      return;
    }
    if (!quantity) {
      message.error('請輸入數量');
      return;
    }

    setLoading(true);
    try {
      // TODO: 調用下單 API
      // await submitOrder({ type: orderType, side, price, quantity });

      message.success('下單成功！');
    } catch (error) {
      message.error('下單失敗');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ padding: 24, minHeight: '100vh', background: '#f0f2f5' }}>
      <Row gutter={[16, 16]}>
        {/* 行情顯示 */}
        <Col span={24}>
          <Card title="BTC/USDT 行情">
            <Row gutter={16}>
              <Col span={6}>
                <Statistic title="最新價" value={50000} suffix="USDT" />
              </Col>
              <Col span={6}>
                <Statistic
                  title="漲跌幅"
                  value={5.28}
                  suffix="%"
                  valueStyle={{ color: '#cf1322' }}
                />
              </Col>
              <Col span={6}>
                <Statistic title="24h 最高" value={51000} suffix="USDT" />
              </Col>
              <Col span={6}>
                <Statistic title="24h 最低" value={49000} suffix="USDT" />
              </Col>
            </Row>
          </Card>
        </Col>

        {/* 下單表單 */}
        <Col span={12}>
          <Card title="下單">
            <Space direction="vertical" style={{ width: '100%' }} size="large">
              {/* 訂單類型 */}
              <div>
                <div style={{ marginBottom: 8 }}>訂單類型</div>
                <Radio.Group
                  value={orderType}
                  onChange={e => setOrderType(e.target.value)}
                >
                  <Radio.Button value="LIMIT">限價</Radio.Button>
                  <Radio.Button value="MARKET">市價</Radio.Button>
                </Radio.Group>
              </div>

              {/* 買賣方向 */}
              <div>
                <div style={{ marginBottom: 8 }}>買賣方向</div>
                <Radio.Group
                  value={side}
                  onChange={e => setSide(e.target.value)}
                >
                  <Radio.Button value="BUY">買入</Radio.Button>
                  <Radio.Button value="SELL">賣出</Radio.Button>
                </Radio.Group>
              </div>

              {/* 價格（限價單才顯示） */}
              {orderType === 'LIMIT' && (
                <div>
                  <div style={{ marginBottom: 8 }}>價格</div>
                  <InputNumber
                    style={{ width: '100%' }}
                    placeholder="輸入價格"
                    value={price}
                    onChange={val => setPrice(val || 0)}
                    min={0}
                  />
                </div>
              )}

              {/* 數量 */}
              <div>
                <div style={{ marginBottom: 8 }}>數量</div>
                <InputNumber
                  style={{ width: '100%' }}
                  placeholder="輸入數量"
                  value={quantity}
                  onChange={val => setQuantity(val || 0)}
                  min={0}
                />
              </div>

              {/* 提交按鈕 */}
              <Button
                type="primary"
                size="large"
                block
                loading={loading}
                onClick={handleSubmit}
                danger={side === 'SELL'}
              >
                {side === 'BUY' ? '買入' : '賣出'} BTC
              </Button>
            </Space>
          </Card>
        </Col>

        {/* 訂單簿（佔位） */}
        <Col span={12}>
          <Card title="訂單簿">
            <div style={{ textAlign: 'center', padding: 40, color: '#999' }}>
              訂單簿數據（待實現）
            </div>
          </Card>
        </Col>
      </Row>
    </div>
  );
}
```

### 6. 路由配置

**`src/App.tsx`**

```typescript
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Login from './pages/Login';
import Register from './pages/Register';
import Trading from './pages/Trading';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/login" element={<Login />} />
        <Route path="/register" element={<Register />} />
        <Route path="/trading" element={<Trading />} />
        <Route path="/" element={<Navigate to="/login" replace />} />
      </Routes>
    </BrowserRouter>
  );
}

export default App;
```

### 7. 入口文件

**`src/main.tsx`**

```typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import 'antd/dist/reset.css';  // Ant Design 樣式

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

### 8. 環境變數

**`.env`**

```bash
VITE_API_BASE_URL=http://localhost:12345
```

然後在代碼中使用：

```typescript
const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
});
```

## 本地開發流程

### 1. 啟動後端服務

```bash
# 啟動完整的 K8s 環境（包含 Gateway）
./script/cluster-up.sh

# 確認 Gateway 可訪問
curl http://localhost:12345/actuator/health
```

### 2. 啟動前端開發服務器

```bash
cd web/exchange-web
npm run dev
```

訪問 http://localhost:5173

### 3. 測試流程

1. **註冊** - 訪問 http://localhost:5173/register
   - 輸入信箱和密碼
   - 點擊註冊

2. **登入** - 自動跳轉到登入頁或手動訪問 /login
   - 輸入剛才註冊的信箱密碼
   - 點擊登入

3. **交易** - 登入成功後跳轉到 /trading
   - 選擇買入/賣出
   - 選擇限價/市價
   - 輸入價格和數量
   - 點擊下單

## 常見問題

### 1. API 請求失敗 CORS 錯誤

需要在後端 Gateway 配置 CORS：

```yaml
# 在 application.yaml 中添加
spring:
  cloud:
    gateway:
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "http://localhost:5173"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: true
```

### 2. Token 過期後如何處理

在 `client.ts` 的攔截器中已經處理：收到 401 自動跳轉到登入頁。

### 3. 如何查看網絡請求

在瀏覽器按 F12 打開開發者工具 → Network 標籤頁，可以看到所有 HTTP 請求。

### 4. 如何調試代碼

- 在代碼中添加 `console.log('變數名', 變數值)`
- 在瀏覽器開發者工具的 Console 標籤查看輸出
- 或在代碼中添加 `debugger;` 暫停執行

## 下一步擴展

當基本流程跑通後，可以依次添加：

1. **訂單列表頁** - 顯示當前使用者的訂單
2. **WebSocket 實時行情** - 替換模擬的行情數據
3. **訂單簿展示** - 顯示買賣盤深度
4. **資產查詢** - 查詢帳戶餘額
5. **簡單圖表** - 使用 Chart.js 顯示 K 線圖

## 學習資源

- [React 官方文檔](https://react.dev/)
- [Ant Design 組件文檔](https://ant.design/components/overview-cn/)
- [Axios 使用指南](https://axios-http.com/docs/intro)
- [TypeScript 入門教程](https://www.typescriptlang.org/docs/handbook/intro.html)

## 總結

這是一個最小化的前端專案，只包含核心功能：
- ✅ 註冊 / 登入
- ✅ 下單表單
- ✅ 簡單的行情展示
- ✅ 路由跳轉
- ✅ Token 管理

代碼簡單易懂，適合前端新手學習和擴展。先把這個基礎版本跑起來，再逐步添加更多功能！
