apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: service-test-hpa
  namespace: default
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: service-test          # 要自動擴縮的 Deployment 名稱
  minReplicas: 1        # Pod 最少數量（最小化資源佔用）
  maxReplicas: 10       # Pod 最多數量（保留擴展能力）
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70   # CPU 使用率至 70% 時擴容（提早擴展避免過載）
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80   # 記憶體使用率至 80% 時擴容
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 30   # 縮容前需連續低於門檻的秒數
      policies:
        - type: Percent
          value: 100                   # 允許的最大縮容幅度。100 代表可在一個 period 內最多減少當前副本數的 100%
          periodSeconds: 60            # 計算幅度的時間窗，60 秒為一個縮容步長