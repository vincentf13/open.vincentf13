<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="open.vincentf13.exchange.user.infra.persistence.mapper.AuthCredentialMapper">

    <resultMap id="AuthCredentialResultMap" type="open.vincentf13.exchange.user.domain.model.AuthCredential">
        <id property="id" column="id" />
        <result property="userId" column="user_id" />
        <result property="credentialType" column="credential_type"
                javaType="open.vincentf13.exchange.user.domain.model.AuthCredentialType" />
        <result property="secretHash" column="secret_hash" />
        <result property="salt" column="salt" />
        <result property="status" column="status" />
        <result property="expiresAt" column="expires_at" />
        <result property="createdAt" column="created_at" />
    </resultMap>

    <insert id="insert" parameterType="open.vincentf13.exchange.user.domain.model.AuthCredential"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO auth_credentials (user_id, credential_type, secret_hash, salt, status, expires_at, created_at)
        VALUES (#{userId}, #{credentialType}, #{secretHash}, #{salt}, #{status}, #{expiresAt}, #{createdAt})
    </insert>

    <select id="findByUserIdAndType" resultMap="AuthCredentialResultMap">
        SELECT id, user_id, credential_type, secret_hash, salt, status, expires_at, created_at
        FROM auth_credentials
        WHERE user_id = #{userId}
          AND credential_type = #{credentialType}
    </select>

</mapper>
