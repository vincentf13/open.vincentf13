<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="open.vincentf13.exchange.user.infra.persistence.mapper.UserMapper">

    <insert id="insertSelective" parameterType="UserPO">
        INSERT INTO users
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="externalId != null">external_id,</if>
            <if test="email != null">email,</if>
            <if test="status != null">status,</if>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="externalId != null">#{externalId},</if>
            <if test="email != null">#{email},</if>
            <if test="status != null">#{status},</if>
        </trim>
    </insert>

    <select id="findBy" parameterType="UserPO" resultType="UserPO">
        SELECT id, external_id, email, status, created_at, updated_at
        FROM users
        <where>
            <if test="id != null">AND id = #{id}</if>
            <if test="externalId != null">AND external_id = #{externalId}</if>
            <if test="email != null">AND email = #{email}</if>
            <if test="status != null">AND status = #{status}</if>
        </where>
        ORDER BY id DESC
    </select>

    <update id="updateSelectiveBy">
        UPDATE users
        <set>
            <if test="record.externalId != null">external_id = #{record.externalId},</if>
            <if test="record.email != null">email = #{record.email},</if>
            <if test="record.status != null">status = #{record.status},</if>
        </set>
        WHERE id = #{id}
          <if test="externalId != null">AND external_id = #{externalId}</if>
    </update>

    <insert id="batchInsert" parameterType="java.util.List">
        INSERT INTO users (id, external_id, email, status)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.id}, #{item.externalId}, #{item.email}, #{item.status})
        </foreach>
    </insert>

</mapper>
