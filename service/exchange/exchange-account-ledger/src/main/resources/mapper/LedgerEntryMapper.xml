<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="open.vincentf13.exchange.account.ledger.infra.persistence.mapper.LedgerEntryMapper">

    <resultMap id="LedgerEntryResultMap" type="open.vincentf13.exchange.account.ledger.infra.persistence.po.LedgerEntryPO">
        <id property="entryId" column="entry_id" />
        <result property="ownerType" column="owner_type" />
        <result property="accountId" column="account_id" />
        <result property="userId" column="user_id" />
        <result property="asset" column="asset" />
        <result property="amount" column="amount" />
        <result property="direction" column="direction" />
        <result property="counterpartyEntryId" column="counterparty_entry" />
        <result property="balanceAfter" column="balance_after" />
        <result property="referenceType" column="reference_type" />
        <result property="referenceId" column="reference_id" />
        <result property="entryType" column="entry_type" />
        <result property="description" column="description" />
        <result property="metadata" column="metadata" />
        <result property="eventTime" column="event_time" />
        <result property="createdAt" column="created_at" />
    </resultMap>

    <insert id="insert" parameterType="open.vincentf13.exchange.account.ledger.infra.persistence.po.LedgerEntryPO">
        INSERT INTO ledger_entries (
            entry_id,
            owner_type,
            account_id,
            user_id,
            asset,
            amount,
            direction,
            counterparty_entry,
            balance_after,
            reference_type,
            reference_id,
            entry_type,
            description,
            metadata,
            event_time,
            created_at
        ) VALUES (
            #{entryId},
            #{ownerType},
            #{accountId},
            #{userId},
            #{asset},
            #{amount},
            #{direction},
            #{counterpartyEntryId},
            #{balanceAfter},
            #{referenceType},
            #{referenceId},
            #{entryType},
            #{description},
            #{metadata},
            #{eventTime},
            #{createdAt}
        )
    </insert>

    <select id="findBy" parameterType="open.vincentf13.exchange.account.ledger.infra.persistence.po.LedgerEntryPO"
            resultMap="LedgerEntryResultMap">
        SELECT * FROM ledger_entries
        <where>
            <if test="entryId != null">AND entry_id = #{entryId}</if>
            <if test="ownerType != null">AND owner_type = #{ownerType}</if>
            <if test="accountId != null">AND account_id = #{accountId}</if>
            <if test="userId != null">AND user_id = #{userId}</if>
            <if test="asset != null">AND asset = #{asset}</if>
            <if test="referenceType != null">AND reference_type = #{referenceType}</if>
            <if test="referenceId != null">AND reference_id = #{referenceId}</if>
            <if test="entryType != null">AND entry_type = #{entryType}</if>
        </where>
        ORDER BY event_time DESC
    </select>
</mapper>
