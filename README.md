# Open Exchange Core (OpenEX)

[![Java](media/ae433042b4597bf74e039b8013dd25ac_MD5.svg)](https://www.oracle.com/java/) [![Spring Boot](media/b01e06057af32c0982e3349dd388fda3_MD5.svg)](https://spring.io/projects/spring-boot) [![Architecture](media/3a0ef3e97e104cb97bb137790032901a_MD5.svg)]() [![License](media/4513e0ed93cf249f2d1269631b59ec9a_MD5.svg)]()

**Open Exchange Core** æ˜¯ä¸€å€‹ç¾ä»£åŒ–ã€é«˜æ€§èƒ½çš„åŠ å¯†è²¨å¹£äº¤æ˜“æ’®åˆèˆ‡æ¸…ç®—ç³»çµ±æ ¸å¿ƒã€‚
æœ¬å°ˆæ¡ˆæ¡ç”¨å¾®æœå‹™æ¶æ§‹è¨­è¨ˆï¼ŒåŸºæ–¼é ˜åŸŸé©…å‹•è¨­è¨ˆ (DDD) ç†å¿µï¼Œå°ˆæ³¨æ–¼è§£æ±ºé«˜ä½µç™¼å ´æ™¯ä¸‹çš„è³‡é‡‘å®‰å…¨ã€å¸³å‹™æº–ç¢ºæ€§èˆ‡è¤‡é›œçš„è¡ç”Ÿå“äº¤æ˜“é‚è¼¯ï¼ˆå¦‚æ§“æ¡¿ã€åæ‰‹ã€å¼·å¹³ï¼‰ã€‚

---

## ğŸŒŸ æ ¸å¿ƒäº®é» (Core Features)

### 1. é‡‘èç´šå¸³å‹™ç³»çµ± (Ledger & Accounting)
*   **é›™å¼è¨˜å¸³ (Double-Entry Bookkeeping):** å¯¦ä½œäº†åš´æ ¼çš„ `UserJournal` (ç”¨æˆ¶æµæ°´) èˆ‡ `PlatformJournal` (å¹³å°æµæ°´) æ©Ÿåˆ¶ï¼Œç¢ºä¿è³‡ç”¢è² å‚µè¡¨ (Assets = Liabilities + Equity) æ°¸é å¹³è¡¡ã€‚
*   **é«˜ä½µç™¼è³‡é‡‘è™•ç†:** æ”¯æ´ `Batch Update` èˆ‡ `Optimistic Locking` (æ¨‚è§€é–) æ©Ÿåˆ¶ï¼Œåœ¨ä¿è­‰æ•¸æ“šä¸€è‡´æ€§çš„å‰æä¸‹æœ€å¤§åŒ–ååé‡ã€‚
*   **å¤šå¸³æˆ¶é«”ç³»:** æ”¯æ´ Spot (ç¾è²¨)ã€Margin (ä¿è­‰é‡‘)ã€PnL (æç›Š) ç­‰å¤šç¨®å¸³æˆ¶é¡å‹çš„éš”é›¢èˆ‡çµç®—ã€‚

### 2. é€²éšè¡ç”Ÿå“äº¤æ˜“ (Advanced Derivatives)
*   **è¤‡é›œå€‰ä½ç®¡ç†:** æ”¯æ´å…¨å€‰/é€å€‰æ¨¡å¼ã€å¤šç©ºé›™å‘æŒå€‰ã€‚
*   **åæ‰‹æ©Ÿåˆ¶ (Position Flip):** ç¨æœ‰çš„ Flip è£œå„Ÿé‚è¼¯ (`OpenToClose` / `CloseToOpen` Compensation)ï¼Œå®Œç¾è™•ç†ç”¨æˆ¶å¾ã€Œåšå¤šã€ç›´æ¥è½‰ç‚ºã€Œåšç©ºã€æ™‚çš„è³‡é‡‘çµç®—èˆ‡ä¿è­‰é‡‘é‡‹æ”¾ï¼Œè§£æ±ºä½µç™¼ä¸‹çš„å€‰ä½æ¶å¥ªå•é¡Œã€‚
*   **é¢¨éšªæ§åˆ¶:** å³æ™‚è¨ˆç®—ç¶­æŒä¿è­‰é‡‘ç‡ (MMR) èˆ‡å¼·å¹³åƒ¹æ ¼ï¼Œä¿éšœç³»çµ±å„Ÿä»˜èƒ½åŠ›ã€‚

### 3. æ¶æ§‹èˆ‡å·¥ç¨‹å¯¦è¸ (Architecture & Engineering)
*   **é ˜åŸŸé©…å‹•è¨­è¨ˆ (DDD):** åš´æ ¼åˆ†å±¤æ¶æ§‹ (Interface, Application, Domain, Infrastructure)ï¼Œæ¥­å‹™é‚è¼¯ç´”ç²¹ä¸”æ˜“æ–¼æ¸¬è©¦ã€‚
*   **äº‹ä»¶é©…å‹•æ¶æ§‹ (EDA):** åŸºæ–¼ Kafka/Redpanda çš„ç•°æ­¥è¨Šæ¯é©…å‹•ï¼Œè§£è€¦äº¤æ˜“æ’®åˆã€æ¸…ç®—èˆ‡å¸³å‹™æ›´æ–°ï¼Œå¯¦ç¾æœ€çµ‚ä¸€è‡´æ€§ã€‚
*   **SDK æ¨¡çµ„åŒ–:** å°è£ `sdk-core`, `sdk-infra-kafka`, `sdk-auth` ç­‰é€šç”¨æ¨¡çµ„ï¼Œçµ±ä¸€æ©«åˆ‡é—œæ³¨é» (Log, Exception, Validation)ã€‚
*   **é›²åŸç”Ÿå°±ç·’:** æä¾›å®Œæ•´çš„ Kubernetes (K8s) éƒ¨ç½²æ¸…å–®ï¼ŒåŒ…å« MySQL, Redis, Kafka, Prometheus, Grafana ç­‰åŸºç¤è¨­æ–½ç·¨æ’ã€‚

---

## ğŸ›  æŠ€è¡“æ£§ (Tech Stack)

| é¡åˆ¥ | æŠ€è¡“çµ„ä»¶ | èªªæ˜ |
|:---|:---|:---|
| **èªè¨€ & æ¡†æ¶** | Java 21, Spring Boot 3, Spring Cloud Alibaba | æ ¸å¿ƒé–‹ç™¼èªè¨€èˆ‡å¾®æœå‹™æ¡†æ¶ |
| **æœå‹™æ²»ç†** | Nacos, OpenFeign, Spring Cloud Gateway | æœå‹™è¨»å†Šã€é…ç½®ä¸­å¿ƒèˆ‡ API ç¶²é—œ |
| **æ•¸æ“šå­˜å„²** | MySQL, MyBatis Plus | é—œè¯å¼è³‡æ–™åº«èˆ‡ ORM |
| **å¿«å– & æ¶ˆæ¯** | Redis, Apache Kafka (Redpanda) | é«˜é€Ÿå¿«å–èˆ‡é«˜ååè¨Šæ¯éšŠåˆ— |
| **å¯è§€æ¸¬æ€§** | Prometheus, Grafana | ç³»çµ±ç›£æ§èˆ‡æŒ‡æ¨™å„€è¡¨æ¿ |
| **åŸºç¤è¨­æ–½** | Kubernetes, Docker | å®¹å™¨åŒ–éƒ¨ç½²èˆ‡ç·¨æ’ |

---

## ğŸ§© æ¨¡çµ„æ¦‚è¦½ (Modules)

*   `service/exchange-account`: **å¸³å‹™æ ¸å¿ƒ**ã€‚è™•ç†å……æã€å‡çµã€è§£å‡ã€è³‡é‡‘åŠƒè½‰èˆ‡æµæ°´è¨˜éŒ„ã€‚
*   `service/exchange-position`: **å€‰ä½æ ¸å¿ƒ**ã€‚ç®¡ç†åˆç´„å€‰ä½ç”Ÿå‘½é€±æœŸã€ç›ˆè™§è¨ˆç®—ã€ä¿è­‰é‡‘ç‡è¨ˆç®—ã€‚
*   `service/exchange-order`: **è¨‚å–®ç®¡ç†**ã€‚è™•ç†å§”è¨—å–®çš„å‰µå»ºã€å–æ¶ˆèˆ‡ç‹€æ…‹æµè½‰ã€‚
*   `service/exchange-matching`: **æ’®åˆå¼•æ“**ã€‚è² è²¬è²·è³£å–®çš„é«˜æ•ˆæ’®åˆ (Order Matching)ã€‚
*   `service/exchange-risk`: **é¢¨æ§ä¸­å¿ƒ**ã€‚å…¨åŸŸé¢¨éšªæª¢æŸ¥èˆ‡é™é¡ç®¡ç†ã€‚
*   `sdk/*`: **åŸºç¤è¨­æ–½èˆ‡é–‹ç™¼å·¥å…·åŒ…**ã€‚

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ (Getting Started)

### å‰ç½®è¦æ±‚
*   JDK 21+
*   Docker & Docker Compose (æˆ– Minikube)
*   Maven 3.8+

### æœ¬åœ°é–‹ç™¼ç’°å¢ƒæ­å»º

1.  **å•Ÿå‹•åŸºç¤è¨­æ–½:**
    ```bash
    cd k8s
    ./cluster-up.sh  # æˆ–ä½¿ç”¨ docker-compose up -d
    ```
2.  **ç·¨è­¯å°ˆæ¡ˆ:**
    ```bash
    mvn clean install -DskipTests
    ```
3.  **å•Ÿå‹•å¾®æœå‹™:**
    ä¾åºå•Ÿå‹• Gateway, Auth, Account, Order, Position, Matching æœå‹™ã€‚

---

## ğŸ“ˆ é–‹ç™¼è¨ˆç•« (Roadmap)

*   [x] åŸºç¤ç¾è²¨èˆ‡åˆç´„äº¤æ˜“
*   [x] é›™å¼è¨˜å¸³èˆ‡è³‡é‡‘çµç®—
*   [x] å€‰ä½åæ‰‹ (Flip) é‚è¼¯
*   [ ] æ’®åˆå¼•æ“æ€§èƒ½å„ªåŒ– (LMAX Disruptor)
*   [ ] å¯¦æ™‚ WebSocket æ¨é€ (K-Line, Depth)
*   [ ] çµ±ä¸€å¼·å¹³å¼•æ“ (Liquidation Engine)

---

## ğŸ“„ ç‰ˆæ¬Šèªªæ˜
MIT License.
