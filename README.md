# Open Exchange Core - è™›æ“¬è²¨å¹£åˆç´„äº¤æ˜“æ‰€æ ¸å¿ƒç³»çµ±

æœ¬å°ˆæ¡ˆæ˜¯ä¸€å€‹å°ˆç‚ºé«˜ä½µç™¼ã€ä½å»¶é²å ´æ™¯è¨­è¨ˆçš„é‡‘èäº¤æ˜“æ ¸å¿ƒç³»çµ±ã€‚é€éè‡ªä¸»ç ”ç™¼çš„åˆ†æ•£å¼å”è­°èˆ‡å…§å­˜æ’®åˆæŠ€è¡“ï¼Œè§£æ±ºäº†ç¾ä»£äº¤æ˜“æ‰€é¢è‡¨çš„ä¸€è‡´æ€§ã€æ“´å±•æ€§èˆ‡ç¨½æ ¸ç—›é»ã€‚

## ğŸš€ æ ¸å¿ƒæŠ€è¡“ç‰¹æ€§

### âš¡ æ¥µè‡´æ•ˆèƒ½èˆ‡ç¢ºå®šæ€§éˆè·¯
* **LMAX ç¢ºå®šæ€§æ’®åˆå¼•æ“**ï¼šæ¡ç”¨ **LMAX Disruptor** æ¶æ§‹æ¨¡å¼ï¼Œé€éç„¡é–éšŠåˆ— (Lock-free Buffer) æ¥µå¤§åŒ–å–®æ ¸ååé‡ï¼Œé”æˆå¾®ç§’ç´šçš„ç¢ºå®šæ€§æ’®åˆå»¶é²ã€‚
* **å–®æ¬¡ WAL å¯«å…¥èˆ‡å¿«ç…§æ¢å¾©**ï¼šå„ªåŒ– IO éˆè·¯å¯¦ç¾ **å–®æ¬¡ WAL (Write-Ahead Logging) é †åºå¯«å…¥**ï¼Œåœ¨ç¢ºä¿å¼·æŒä¹…åŒ–çš„åŒæ™‚ï¼Œå°‡ç£ç¢Ÿ IO å½±éŸ¿é™è‡³æœ€ä½ã€‚çµåˆå¿«ç…§æ©Ÿåˆ¶ï¼Œé”æˆç§’ç´šå®¹ç½æ¢å¾©ã€‚
    * ğŸ¥ [WAL å®¹ç½æ¸¬è©¦æ¼”ç¤º](https://www.youtube.com/watch?v=ZWwiQsdZz84)
* **é«˜ä½µç™¼èˆ‡æ¶æ§‹è§£è€¦**ï¼šæ ¸å¿ƒéˆè·¯ï¼ˆæ’®åˆã€çµç®—ã€é¢¨æ§ã€ä¸€è‡´æ€§ï¼‰å…¨é¢è§£è€¦ï¼Œæ”¯æ´è¡Œæƒ…èˆ‡è³‡ç”¢æœå‹™æ©«å‘æ“´å±•äº¤æ˜“é›†ç¾¤ã€‚
    * ğŸ¥ [è‡ªå‹•åŒ–æ•´åˆæ¸¬è©¦äº¤æ˜“éˆè·¯æ¼”ç¤º](https://www.youtube.com/watch?v=dn5fbFdlFOQ)

### ğŸ¤– AI è¦ªå’Œ SDK æ¶æ§‹ (AI-Driven Architecture)
* **Context è² è¼‰æ¥µå°åŒ–**ï¼šå°‡è¤‡é›œçš„æ¡†æ¶é…ç½®èˆ‡åº•å±¤é‚è¼¯å°è£æ–¼ SDK å…§éƒ¨ã€‚AI Agent åƒ…éœ€ç†è§£ç°¡æ½”çš„è¦ç¯„ä»‹é¢å³å¯ç·¨å¯«ä»£ç¢¼ï¼Œå¤§å¹…ç¯€çœ Token æ¶ˆè€—ä¸¦æå‡ç”Ÿæˆæº–ç¢ºåº¦ã€‚
* **çµæ§‹åŒ–æ•¸æ“šé—œè¯**ï¼šå…¨é¢æ¡ç”¨è¦ç¯„åŒ– Event å°è£èˆ‡è‡ªå‹• Trace ID æ³¨å…¥ã€‚é€éå»ºç«‹æ•¸æ“šé–“çš„é—œè¯æ€§ï¼Œå”åŠ© AI æ›´ç²¾æº–åœ°ç†è§£æ¥­å‹™æµç¨‹ä¸¦é€²è¡Œè‡ªå‹•åŒ–æ•…éšœå®šä½ã€‚
* **å–®ä¸€äº‹å¯¦ä¾†æºä»‹é¢ (SSOT)**ï¼šé€é Interface å…±äº«æŠ€è¡“ï¼Œé”æˆå®¢æˆ¶ç«¯èˆ‡æœå‹™ç«¯æ ¡é©—è¦å‰‡ 100% åŒæ­¥ï¼Œæ¸›å°‘ AI åœ¨è·¨æœå‹™é–‹ç™¼æ™‚çš„é‡è¦†ç†è§£èˆ‡æºé€šæˆæœ¬ã€‚
* **é«˜éšé‚è¼¯æŠ½è±¡ (Task Wrapper)**ï¼šæä¾›å°ˆé–€çš„ `task-service` å°è£åˆ†ä½ˆå¼äº‹å‹™ç‹€æ…‹ç®¡ç†ï¼Œè®“ AI å°ˆæ³¨æ–¼é–‹ç™¼æ ¸å¿ƒæ¥­å‹™é‚è¼¯ï¼Œè€Œä¸å—ç¹é›œçš„ç‹€æ…‹æµè½‰å¹²æ“¾ã€‚
    * ğŸ¥ [AI æ™‚ä»£ä¸‹çš„æ¶æ§‹è¨­è¨ˆï¼šSDK å¦‚ä½•æˆç‚ºæ ¸å¿ƒ](https://www.youtube.com/watch?v=yHxeaZEK_t0)

### ğŸ’° é‡‘èç´šæœƒè¨ˆèˆ‡å‹•æ…‹è³‡ç”¢è² å‚µå»ºæ¨¡
* **å‹•æ…‹è³‡ç”¢è² å‚µè¡¨å»ºæ¨¡**ï¼šå…§ç½®äº¤æ˜“æ‰€ç´šé‡‘æµæœƒè¨ˆæ¨¡çµ„ï¼Œæ”¯æ´å¤šç¨®æ•¸ä½è³‡ç”¢å‹•æ…‹å»ºæ¨¡ã€‚æ­¤æ¶æ§‹èƒ½é€éæ•¸æ“šé—œè¯ä¸»å‹•å®šä½ç•°å¸¸ï¼Œå°‡ã€Œäº‹å¾Œå¯©è¨ˆã€è½‰åŒ–ç‚ºã€Œå³æ™‚é¢¨æ§ã€ã€‚
    * ğŸ¥ [å¯¦æ™‚è³‡ç”¢è² å‚µè¡¨æ“ä½œæ¼”ç¤º](https://www.youtube.com/watch?v=MYQobecR8DA)
* **å¤šç¶­åº¦è‡ªå‹•å°å¸³ (Future-Ready)**ï¼šå·²å»ºç½®æ·±å±¤æ•¸æ“šé—œè¯åŸºç¤ï¼Œæ”¯æŒæœªä¾†æ“´å±•è‡³åŒ…å«æ’®åˆæµæ°´ã€éŒ¢åŒ…é¤˜é¡ã€å¸³å‹™åˆ†éŒ„èˆ‡ç¬¬ä¸‰æ–¹çµç®—çš„å¤šå±¤æ¬¡æ ¸å°ï¼Œå¯¦ç¾æ•¸æ“šä¸€è‡´æ€§è‡ªç™’ã€‚
* **å°ˆæ¥­å¯©è¨ˆèˆ‡æŸ¥å¸³è³¦èƒ½**ï¼šæä¾›å°ˆæ¥­æœƒè¨ˆæ‰€éœ€çš„æŸ¥å¸³å·¥å…·ï¼Œæ”¯æ´åˆ©ç”¨è¤‡å¼ç°¿è¨˜æŠ€å·§é€²è¡Œæ·±åº¦è¿½è¹¤ï¼Œå¯é‡å»ºä»»ä¸€æ™‚åˆ»çš„è²¡å‹™å¿«ç…§ï¼Œç¢ºä¿ 100% æ•¸æ“šå®Œæ•´æ€§èˆ‡å¯è¿½æº¯æ€§ã€‚
* **å…¨å ´æ™¯å¸³æˆ¶è¦–åœ–**ï¼šé‡å°å¤šå¹£ç¨®ã€å¤šå€‰ä½è³‡ç”¢æä¾›é«˜åº¦çµæ§‹åŒ–çš„å…¨æ™¯å±•ç¤ºï¼Œå”åŠ©è²¡å‹™åœ˜éšŠé”æˆç§’ç´šå°å¸³ï¼Œå¤§å¹…é™ä½äººå·¥ç¨½æ ¸æˆæœ¬è‡³è¶¨è¿‘æ–¼é›¶ã€‚

### ğŸ›¡ï¸ åˆ†æ•£å¼ä¸€è‡´æ€§ï¼šè‡ªç ” Flip Protocol
* **çµ‚çµè³‡æºçˆ­æ¶çš„ã€Œéš±å½¢èª¿åº¦ã€**ï¼šå¯¦ä½œåŸºæ–¼ **Flip é‚è¼¯** çš„åˆ†æ•£å¼äº‹å‹™å”è­°ï¼Œå°ˆé–€å°ä»˜åˆ†æ•£å¼ç’°å¢ƒä¸­æœ€æ£˜æ‰‹çš„ **Resource Stealing (è³‡æºè¡çª/ç«Šå–)** å›°å¢ƒã€‚å®ƒèƒ½åƒæ™ºæ…§å¤§è…¦ä¸€æ¨£ï¼Œåœ¨æ¯«ç§’é–“åŒ–è§£å¤šç¯€é»å°åŒä¸€è³‡æºçš„çˆ­å¥ªã€‚
    * ğŸ¥ [Flip Protocol é‚è¼¯è§£æèˆ‡å¯¦ä½œ](https://youtu.be/R9S6q3e9xgw)
* **æ‰“ç ´æ•ˆèƒ½ç“¶é ¸çš„å¼·ä¸€è‡´æ€§**ï¼šä¸åŒæ–¼å‚³çµ±å…±è­˜å”è­°çš„æ²‰é‡è² æ“”ï¼ŒFlip Protocol åœ¨ç¶­æŒé‡‘èç´š **å¼·ä¸€è‡´æ€§** èˆ‡ **äº¤æ˜“åŸå­æ€§** çš„åŒæ™‚ï¼Œä»èƒ½ä¿æŒé©šäººçš„ååé‡ã€‚

### â˜¸ï¸ é›²åŸç”Ÿè‡ªå‹•åŒ–é‹ç¶­ (DevOps)
* **æ¥µè‡´é–‹ç™¼é«”é©—**ï¼šæä¾›ä¸€éµ K8s é›†ç¾¤å»ºç½®ã€IDEA ç›´é€£é ç«¯ K8s èª¿è©¦ã€å…¨ç’°å¢ƒçµ±ä¸€é…ç½®èˆ‡æ™ºèƒ½ CI/CD æµç¨‹ã€‚
    * ğŸ¥ [K8s é›†ç¾¤å¿«é€Ÿå»ºç½®å¯¦æˆ°](https://www.youtube.com/watch?v=kvOtuF93q2s&t=1896s)
* **æ¥µè‡´è³‡æºæ§åˆ¶**ï¼šç¶“éæ·±å±¤å„ªåŒ–ï¼Œæ•´å€‹é›†ç¾¤åƒ…éœ€ [**8.3 GB å…§å­˜**](https://1drv.ms/i/c/095e0f59106abb25/IQC4eVXKMxlLQYRJIKax9TRiAem6GldZCpNL-5IgXm8Gz2A?e=2ccROi) å³å¯ç©©å®šé‹è¡Œã€‚
* **å…¨é¢è§€æ¸¬èƒ½åŠ›**ï¼šé›†æˆé«˜æ•ˆèƒ½ç›£æ§ SDKã€è‡ªå‹•åŒ–å‘Šè­¦èˆ‡æ“´å®¹æ©Ÿåˆ¶ï¼Œå…¨é¢è¦†è“‹æ’®åˆæƒ…å¢ƒèˆ‡è³‡ç”¢å¸³æˆ¶æ ¸å°ã€‚
    * ğŸ¥ [é«˜æ•ˆèƒ½å…¨æ£§ç›£æ§èˆ‡æŒ‡æ¨™æ²»ç†](https://www.youtube.com/watch?v=t4foO-PD3eI)

---

## ğŸ› ï¸ å¦‚ä½•é–‹å§‹èˆ‡å»ºç½®ç’°å¢ƒ

æœ¬å°ˆæ¡ˆæä¾›é«˜åº¦è‡ªå‹•åŒ–çš„å»ºç½®è…³æœ¬ï¼Œåƒ…éœ€å°‘è¨±æ­¥é©Ÿå³å¯åœ¨æœ¬åœ°ç«¯æ‹‰èµ·å®Œæ•´çš„äº¤æ˜“æ‰€åŸºç¤è¨­æ–½ã€‚

### 1. æº–å‚™ç’°å¢ƒ
* **æ“ä½œç³»çµ±**ï¼šå»ºè­°ä½¿ç”¨ Linux æˆ– macOS (Windows ç”¨æˆ¶è«‹ä½¿ç”¨ WSL2)ã€‚
* **å¿…è¦å·¥å…·**ï¼š
    * **JDK 21+** (å»ºè­°ä½¿ç”¨ Temurin)ã€‚
    * **Docker** èˆ‡ **kind** (ç”¨æ–¼å»ºç«‹æœ¬åœ° K8s é›†ç¾¤)ã€‚
    * **kubectl**

### 2. å¿«é€Ÿå•Ÿå‹•é›†ç¾¤
```bash
# 1. å»ºç«‹ K8s é›†ç¾¤
kind create cluster --name exchange

# 2. åŸ·è¡Œä¸€éµå•Ÿå‹•è…³æœ¬
bash ./script/cluster-up.sh
```
è…³æœ¬åŸ·è¡Œæ™‚æä¾›ä»¥ä¸‹é¸é …ï¼ˆå¯çµ„åˆè¼¸å…¥ï¼Œå¦‚ `123`ï¼‰ï¼š
* **é¸é … 1ï¼šåŸºç¤è¨­æ–½ (Default Infra)** - è‡ªå‹•å»ºç½® Ingress, Nacos, MySQL, Redis, Kafka ç­‰ã€‚
    * *ä¾è³´å·¥å…·*ï¼š`kubectl`, `docker`
* **é¸é … 2ï¼šæŒçºŒéƒ¨ç½² (ArgoCD)** - è‡ªå‹•å®‰è£èˆ‡é…ç½® GitOps ç’°å¢ƒã€‚
    * *ä¾è³´å·¥å…·*ï¼š`kubectl`, `argocd` CLI, `nc` (netcat)
* **é¸é … 3ï¼šå…¨æ£§ç›£æ§ (Monitoring)** - éƒ¨ç½² Prometheusã€Grafana èˆ‡ Alertmanagerã€‚
    * *ä¾è³´å·¥å…·*ï¼š`kubectl`

> ğŸ’¡ **æç¤º**ï¼šè©³ç´°æ­¥é©Ÿå¯åƒé–± [æ‰‹å‹•å»ºç½®æ–‡ä»¶](doc/æ‰‹å‹•å»ºç½®.md)ã€‚
### 3. æœ¬åœ°ç›´é€£ K8S èª¿è©¦ (Telepresence)
ç‚ºäº†è®“é–‹ç™¼æ©Ÿç›´æ¥è¨ªå• K8S å…§ç¶²æœå‹™ï¼ˆå¦‚ `*.cluster.local`ï¼‰ä¸¦å¾ IDE ç›´æ¥èª¿è©¦ï¼Œå»ºè­°å®‰è£ Telepresenceï¼š
* **å®‰è£ (Linux)**ï¼š
  ```bash
  sudo curl -fL https://app.getambassador.io/download/tel2/linux/amd64/latest/telepresence -o /usr/local/bin/telepresence
  sudo chmod a+x /usr/local/bin/telepresence
  ```
* **é€£æ¥é›†ç¾¤**ï¼š
  ```bash
  telepresence connect
  ```
* **æ•ˆæœ**ï¼šé€£æ¥å¾Œï¼Œæ‚¨å¯ç›´æ¥è¨ªå• `http://infra-nacos.default.svc.cluster.local:8848` æˆ–åœ¨æœ¬åœ° IDE åŸ·è¡Œæœå‹™ä¸¦ç›´é€£ K8S å…§çš„è³‡æ–™åº«èˆ‡ä¸­é–“ä»¶ã€‚

### 4. å•Ÿå‹• WEB æœå‹™èˆ‡è¨ªå•
1. **é€²å…¥å‰ç«¯ç›®éŒ„**ï¼š`cd service/exchange/exchange-web`ã€‚
2. **å¿«é€Ÿå•Ÿå‹•**ï¼šåŸ·è¡Œ `bash quick-start.sh`ã€‚è©²è…³æœ¬æœƒè‡ªå‹•å®‰è£ä¾è³´ä¸¦å¼•å°æ‚¨è¨­å®šå¾Œç«¯ API åœ°å€ï¼ˆé è¨­ç‚º `http://localhost:12345`ï¼‰ã€‚
3. **ç€è¦½è¨ªå•**ï¼šé–‹å•Ÿ `http://localhost:5173` å³å¯é€²å…¥äº¤æ˜“æ‰€æ“ä½œä»‹é¢ã€‚

### 5. è¨ªå•ç›£æ§å„€è¡¨æ¿
å•Ÿå‹• Telepresence å¾Œï¼Œå¯ç›´æ¥é€éä»¥ä¸‹ç¶²å€è¨ªå•ï¼ˆç„¡éœ€é¡å¤–é…ç½® Hostsï¼‰ï¼š
* **Grafana**: `http://grafana.monitoring.svc.cluster.local:3000` (å¸³å¯†: `admin/admin123`)
* **Prometheus**: `http://prometheus.monitoring.svc.cluster.local:9090`
* **Nacos**: `http://infra-nacos.default.svc.cluster.local:8848`
* **Redpanda (Kafka UI)**: `http://redpanda-console.default.svc.cluster.local:8080`

---

## ğŸ“„ é–‹æºå”è­°
æœ¬å°ˆæ¡ˆæ¡ç”¨ [Apache-2.0 License](LICENSE.md) æˆæ¬Šã€‚