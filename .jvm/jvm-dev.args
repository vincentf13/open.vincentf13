# JVM args â€” development profile
# Usage:
#   java @.jvm/jvm-dev.args -jar app.jar
# Or export:
#   export JDK_JAVA_OPTIONS="@${PWD}/.jvm/jvm-dev.args"

# === Diagnostics & debugging ===
-ea                                           # enable assertions
-XX:+ShowCodeDetailsInExceptionMessages       # precise NPE / exception messages
-Dfile.encoding=UTF-8                         # explicit charset (redundant on JDK18+, but kept)

# === Memory incident handling ===
-XX:+HeapDumpOnOutOfMemoryError               # write heap dump on OOM
-XX:HeapDumpPath=./logs/oom-%p.hprof          # heap dump location
-XX:+ExitOnOutOfMemoryError                   # fail fast on OOM

# === GC / safepoint logging ===
-Xlog:gc*,safepoint,class+load=info:file=./logs/jvm-%p.log:time,uptime,level,tags
-XX:+UseStringDeduplication                   # shrink retained strings under G1

# === CDS (Application Class-Data Sharing) ===
-XX:SharedArchiveFile=app-cds.jsa             # try to load shared archive at startup
-Xshare:auto                                  # gracefully skip CDS if incompatible
-XX:ArchiveClassesAtExit=app-cds.jsa          # record new archive on exit

# === Optional warm-start tweaks ===
# -XX:TieredStopAtLevel=1                     # C1-only compilation for faster warmup
# -XX:CICompilerCount=2                       # limit compiler threads to reduce jitter

# === Project Loom helpers (optional) ===
# -Djdk.virtualThreadScheduler.parallelism=0  # carrier threads = available processors
# -Djdk.virtualThreadScheduler.maxPoolSize=0  # no upper bound on carrier pool
# -Djdk.tracePinnedThreads=full               # diagnose blocking operations on virtual threads

# === Flight Recorder (enable when troubleshooting) ===
# -XX:StartFlightRecording=filename=./logs/jfr-%p.jfr,settings=profile,dumponexit=true

# === Native memory diagnostics (enable on demand) ===
# -XX:+UnlockDiagnosticVMOptions
# -XX:NativeMemoryTracking=summary
# -XX:+PrintNMTStatistics

# === Legacy module opens (only if older libs require deep reflection) ===
# --add-opens=java.base/java.lang=ALL-UNNAMED
# --add-opens=java.base/java.util=ALL-UNNAMED
# --add-opens=java.base/sun.nio.ch=ALL-UNNAMED
