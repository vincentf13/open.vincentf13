# ğŸ¥ æ¼”ç¤ºå½±ç‰‡

- [Web äº¤æ˜“çµ‚ç«¯æ¼”ç¤º (React / Ant Design)](https://www.youtube.com/watch?v=MYQobecR8DA&t=67s)

# Exchange Web å¿«é€Ÿä¸Šæ‰‹

## æ¦‚è¿°

é€™æ˜¯ä¸€å€‹æœ€å°åŒ–çš„äº¤æ˜“æ‰€å‰ç«¯å°ˆæ¡ˆï¼Œä½¿ç”¨æœ€ç°¡å–®çš„æŠ€è¡“å¯¦ç¾è¨»å†Šã€ç™»å…¥ã€ä¸‹å–®ã€è¡Œæƒ…ç­‰åŸºæœ¬åŠŸèƒ½ã€‚

**ç›®æ¨™**ï¼šç”¨æœ€å°‘çš„ä»£ç¢¼å¿«é€Ÿé©—è­‰åŠŸèƒ½ï¼Œé©åˆå‰ç«¯æ–°æ‰‹ä¸Šæ‰‹ã€‚

## è¨­è¨ˆé¢¨æ ¼

åœ“è§’ 8pxï¼ˆæ‰€æœ‰å¡ç‰‡ & æŒ‰éˆ•ä¸€è‡´ï¼‰
é¡é¢ç»ç’ƒï¼ˆåå°„ä¸­ç­‰ã€ç„¡éœ§ã€ç„¡ç²’å­ï¼‰
èƒŒæ™¯ è—ç°æ¼¸å±¤ï¼ˆ#D6E4F0 â†’ #AEC2D6ï¼‰
Kç·šé…è‰² è—ç™½å–®è‰²
ä½ˆå±€ Cï¼ˆä¸Š K ç·šã€ä¸‹ä¸‰å€å¡ç‰‡ã€åº•éƒ¨ä¸‹å–®ï¼‰

## æŠ€è¡“é¸æ“‡

é¸æ“‡æœ€ç°¡å–®ã€æ–‡æª”æœ€è±å¯Œçš„æŠ€è¡“ï¼š

```
React          - æœ€æµè¡Œçš„ UI æ¡†æ¶
TypeScript     - æä¾›å‹åˆ¥æç¤ºï¼Œæ¸›å°‘éŒ¯èª¤
Vite           - å¿«é€Ÿå•Ÿå‹•çš„æ§‹å»ºå·¥å…·
Ant Design     - ç¾æˆçš„ UI çµ„ä»¶åº«ï¼ˆä¸ç”¨è‡ªå·±å¯«æ¨£å¼ï¼‰
Axios          - HTTP è«‹æ±‚åº«
```

## å¿«é€Ÿé–‹å§‹

### 1. å‰µå»ºå°ˆæ¡ˆ

```bash
# é€²å…¥å°ˆæ¡ˆæ ¹ç›®éŒ„
cd /mnt/c/iProject/open.vincentf13

# å‰µå»ºå‰ç«¯å°ˆæ¡ˆ
mkdir -p web/exchange-web
cd web/exchange-web

# ä½¿ç”¨ Vite å‰µå»º React + TypeScript å°ˆæ¡ˆ
npm create vite@latest . -- --template react-ts

# å®‰è£ä¾è³´
npm install

# å®‰è£é¡å¤–éœ€è¦çš„åº«
npm install axios antd react-router-dom
npm install @ant-design/icons  # Ant Design åœ–æ¨™

# å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
npm run dev
```

è¨ªå• http://localhost:5173 å°±èƒ½çœ‹åˆ°é é¢äº†ï¼

### 2. ç›®éŒ„çµæ§‹ï¼ˆæœ€ç°¡åŒ–ï¼‰

```
web/exchange-web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/              # API èª¿ç”¨
â”‚   â”‚   â”œâ”€â”€ client.ts     # Axios é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.ts       # ç™»å…¥ API
â”‚   â”‚   â””â”€â”€ user.ts       # ä½¿ç”¨è€… API
â”‚   â”œâ”€â”€ pages/            # é é¢
â”‚   â”‚   â”œâ”€â”€ Login.tsx     # ç™»å…¥é 
â”‚   â”‚   â”œâ”€â”€ Register.tsx  # è¨»å†Šé 
â”‚   â”‚   â”œâ”€â”€ Trading.tsx   # äº¤æ˜“é ï¼ˆä¸‹å–®+è¡Œæƒ…ï¼‰
â”‚   â”‚   â””â”€â”€ Orders.tsx    # è¨‚å–®åˆ—è¡¨
â”‚   â”œâ”€â”€ App.tsx           # ä¸»æ‡‰ç”¨
â”‚   â”œâ”€â”€ main.tsx          # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ vite-env.d.ts
â”œâ”€â”€ .env                  # ç’°å¢ƒè®Šæ•¸
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts
```

## æ ¸å¿ƒä»£ç¢¼å¯¦ç¾

### 1. é…ç½® API å®¢æˆ¶ç«¯

**`src/api/client.ts`** - Axios åŸºç¤é…ç½®

```typescript
import axios from 'axios';

const apiClient = axios.create({
  baseURL: 'http://localhost:12345',  // Gateway åœ°å€
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// è«‹æ±‚æ””æˆªå™¨ï¼šè‡ªå‹•æ·»åŠ  Token
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('accessToken');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// éŸ¿æ‡‰æ””æˆªå™¨ï¼šçµ±ä¸€éŒ¯èª¤è™•ç†
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('accessToken');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

### 2. API å‡½æ•¸å°è£

**`src/api/auth.ts`** - èªè­‰ç›¸é—œ API

```typescript
import apiClient from './client';

// ç™»å…¥
export const login = async (email: string, password: string) => {
  const response = await apiClient.post('/auth/api/login', {
    email,
    password,
  });
  return response.data;
};

// è¨»å†Š
export const register = async (email: string, password: string) => {
  const response = await apiClient.post('/user/api/user', {
    email,
    password,
    externalId: `user-${Date.now()}`,
  });
  return response.data;
};
```

**`src/api/user.ts`** - ä½¿ç”¨è€… API

```typescript
import apiClient from './client';

// ç²å–ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š
export const getCurrentUser = async () => {
  const response = await apiClient.get('/user/api/user/me');
  return response.data;
};
```

### 3. ç™»å…¥é é¢

**`src/pages/Login.tsx`**

```typescript
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Form, Input, Button, Card, message } from 'antd';
import { UserOutlined, LockOutlined } from '@ant-design/icons';
import { login } from '../api/auth';

export default function Login() {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  const handleLogin = async (values: { email: string; password: string }) => {
    setLoading(true);
    try {
      const result = await login(values.email, values.password);

      if (result.code === '0') {
        // å„²å­˜ Token
        localStorage.setItem('accessToken', result.data.token);
        message.success('ç™»å…¥æˆåŠŸï¼');
        navigate('/trading');
      } else {
        message.error(result.message || 'ç™»å…¥å¤±æ•—');
      }
    } catch (error: any) {
      message.error(error.response?.data?.message || 'ç™»å…¥å¤±æ•—');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      minHeight: '100vh',
      background: '#f0f2f5'
    }}>
      <Card title="äº¤æ˜“æ‰€ç™»å…¥" style={{ width: 400 }}>
        <Form onFinish={handleLogin}>
          <Form.Item
            name="email"
            rules={[{ required: true, message: 'è«‹è¼¸å…¥ä¿¡ç®±' }]}
          >
            <Input
              prefix={<UserOutlined />}
              placeholder="ä¿¡ç®±"
            />
          </Form.Item>

          <Form.Item
            name="password"
            rules={[{ required: true, message: 'è«‹è¼¸å…¥å¯†ç¢¼' }]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="å¯†ç¢¼"
            />
          </Form.Item>

          <Form.Item>
            <Button
              type="primary"
              htmlType="submit"
              loading={loading}
              block
            >
              ç™»å…¥
            </Button>
          </Form.Item>

          <Button type="link" onClick={() => navigate('/register')} block>
            æ²’æœ‰å¸³è™Ÿï¼Ÿç«‹å³è¨»å†Š
          </Button>
        </Form>
      </Card>
    </div>
  );
}
```

### 4. è¨»å†Šé é¢

**`src/pages/Register.tsx`**

```typescript
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Form, Input, Button, Card, message } from 'antd';
import { UserOutlined, LockOutlined } from '@ant-design/icons';
import { register } from '../api/auth';

export default function Register() {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  const handleRegister = async (values: {
    email: string;
    password: string;
    confirm: string;
  }) => {
    if (values.password !== values.confirm) {
      message.error('å…©æ¬¡å¯†ç¢¼è¼¸å…¥ä¸ä¸€è‡´');
      return;
    }

    setLoading(true);
    try {
      const result = await register(values.email, values.password);

      if (result.code === '0') {
        message.success('è¨»å†ŠæˆåŠŸï¼è«‹ç™»å…¥');
        navigate('/login');
      } else {
        message.error(result.message || 'è¨»å†Šå¤±æ•—');
      }
    } catch (error: any) {
      message.error(error.response?.data?.message || 'è¨»å†Šå¤±æ•—');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      minHeight: '100vh',
      background: '#f0f2f5'
    }}>
      <Card title="è¨»å†Šå¸³è™Ÿ" style={{ width: 400 }}>
        <Form onFinish={handleRegister}>
          <Form.Item
            name="email"
            rules={[
              { required: true, message: 'è«‹è¼¸å…¥ä¿¡ç®±' },
              { type: 'email', message: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„ä¿¡ç®±' }
            ]}
          >
            <Input
              prefix={<UserOutlined />}
              placeholder="ä¿¡ç®±"
            />
          </Form.Item>

          <Form.Item
            name="password"
            rules={[
              { required: true, message: 'è«‹è¼¸å…¥å¯†ç¢¼' },
              { min: 6, message: 'å¯†ç¢¼è‡³å°‘ 6 ä½' }
            ]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="å¯†ç¢¼"
            />
          </Form.Item>

          <Form.Item
            name="confirm"
            rules={[{ required: true, message: 'è«‹ç¢ºèªå¯†ç¢¼' }]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="ç¢ºèªå¯†ç¢¼"
            />
          </Form.Item>

          <Form.Item>
            <Button
              type="primary"
              htmlType="submit"
              loading={loading}
              block
            >
              è¨»å†Š
            </Button>
          </Form.Item>

          <Button type="link" onClick={() => navigate('/login')} block>
            å·²æœ‰å¸³è™Ÿï¼Ÿç«‹å³ç™»å…¥
          </Button>
        </Form>
      </Card>
    </div>
  );
}
```

### 5. äº¤æ˜“é é¢ï¼ˆç°¡åŒ–ç‰ˆï¼‰

**`src/pages/Trading.tsx`**

```typescript
import { useState } from 'react';
import { Card, InputNumber, Button, Radio, Space, message, Statistic, Row, Col } from 'antd';

export default function Trading() {
  const [orderType, setOrderType] = useState<'LIMIT' | 'MARKET'>('LIMIT');
  const [side, setSide] = useState<'BUY' | 'SELL'>('BUY');
  const [price, setPrice] = useState<number>(0);
  const [quantity, setQuantity] = useState<number>(0);
  const [loading, setLoading] = useState(false);

  const handleSubmit = async () => {
    if (orderType === 'LIMIT' && !price) {
      message.error('è«‹è¼¸å…¥åƒ¹æ ¼');
      return;
    }
    if (!quantity) {
      message.error('è«‹è¼¸å…¥æ•¸é‡');
      return;
    }

    setLoading(true);
    try {
      // TODO: èª¿ç”¨ä¸‹å–® API
      // await submitOrder({ type: orderType, side, price, quantity });

      message.success('ä¸‹å–®æˆåŠŸï¼');
    } catch (error) {
      message.error('ä¸‹å–®å¤±æ•—');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ padding: 24, minHeight: '100vh', background: '#f0f2f5' }}>
      <Row gutter={[16, 16]}>
        {/* è¡Œæƒ…é¡¯ç¤º */}
        <Col span={24}>
          <Card title="BTC/USDT è¡Œæƒ…">
            <Row gutter={16}>
              <Col span={6}>
                <Statistic title="æœ€æ–°åƒ¹" value={50000} suffix="USDT" />
              </Col>
              <Col span={6}>
                <Statistic
                  title="æ¼²è·Œå¹…"
                  value={5.28}
                  suffix="%"
                  valueStyle={{ color: '#cf1322' }}
                />
              </Col>
              <Col span={6}>
                <Statistic title="24h æœ€é«˜" value={51000} suffix="USDT" />
              </Col>
              <Col span={6}>
                <Statistic title="24h æœ€ä½" value={49000} suffix="USDT" />
              </Col>
            </Row>
          </Card>
        </Col>

        {/* ä¸‹å–®è¡¨å–® */}
        <Col span={12}>
          <Card title="ä¸‹å–®">
            <Space direction="vertical" style={{ width: '100%' }} size="large">
              {/* è¨‚å–®é¡å‹ */}
              <div>
                <div style={{ marginBottom: 8 }}>è¨‚å–®é¡å‹</div>
                <Radio.Group
                  value={orderType}
                  onChange={e => setOrderType(e.target.value)}
                >
                  <Radio.Button value="LIMIT">é™åƒ¹</Radio.Button>
                  <Radio.Button value="MARKET">å¸‚åƒ¹</Radio.Button>
                </Radio.Group>
              </div>

              {/* è²·è³£æ–¹å‘ */}
              <div>
                <div style={{ marginBottom: 8 }}>è²·è³£æ–¹å‘</div>
                <Radio.Group
                  value={side}
                  onChange={e => setSide(e.target.value)}
                >
                  <Radio.Button value="BUY">è²·å…¥</Radio.Button>
                  <Radio.Button value="SELL">è³£å‡º</Radio.Button>
                </Radio.Group>
              </div>

              {/* åƒ¹æ ¼ï¼ˆé™åƒ¹å–®æ‰é¡¯ç¤ºï¼‰ */}
              {orderType === 'LIMIT' && (
                <div>
                  <div style={{ marginBottom: 8 }}>åƒ¹æ ¼</div>
                  <InputNumber
                    style={{ width: '100%' }}
                    placeholder="è¼¸å…¥åƒ¹æ ¼"
                    value={price}
                    onChange={val => setPrice(val || 0)}
                    min={0}
                  />
                </div>
              )}

              {/* æ•¸é‡ */}
              <div>
                <div style={{ marginBottom: 8 }}>æ•¸é‡</div>
                <InputNumber
                  style={{ width: '100%' }}
                  placeholder="è¼¸å…¥æ•¸é‡"
                  value={quantity}
                  onChange={val => setQuantity(val || 0)}
                  min={0}
                />
              </div>

              {/* æäº¤æŒ‰éˆ• */}
              <Button
                type="primary"
                size="large"
                block
                loading={loading}
                onClick={handleSubmit}
                danger={side === 'SELL'}
              >
                {side === 'BUY' ? 'è²·å…¥' : 'è³£å‡º'} BTC
              </Button>
            </Space>
          </Card>
        </Col>

        {/* è¨‚å–®ç°¿ï¼ˆä½”ä½ï¼‰ */}
        <Col span={12}>
          <Card title="è¨‚å–®ç°¿">
            <div style={{ textAlign: 'center', padding: 40, color: '#999' }}>
              è¨‚å–®ç°¿æ•¸æ“šï¼ˆå¾…å¯¦ç¾ï¼‰
            </div>
          </Card>
        </Col>
      </Row>
    </div>
  );
}
```

### 6. è·¯ç”±é…ç½®

**`src/App.tsx`**

```typescript
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Login from './pages/Login';
import Register from './pages/Register';
import Trading from './pages/Trading';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/login" element={<Login />} />
        <Route path="/register" element={<Register />} />
        <Route path="/trading" element={<Trading />} />
        <Route path="/" element={<Navigate to="/login" replace />} />
      </Routes>
    </BrowserRouter>
  );
}

export default App;
```

### 7. å…¥å£æ–‡ä»¶

**`src/main.tsx`**

```typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import 'antd/dist/reset.css';  // Ant Design æ¨£å¼

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

### 8. ç’°å¢ƒè®Šæ•¸

**`.env`**

```bash
VITE_API_BASE_URL=http://localhost:12345
```

ç„¶å¾Œåœ¨ä»£ç¢¼ä¸­ä½¿ç”¨ï¼š

```typescript
const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
});
```

## æœ¬åœ°é–‹ç™¼æµç¨‹

### 1. å•Ÿå‹•å¾Œç«¯æœå‹™

```bash
# å•Ÿå‹•å®Œæ•´çš„ K8s ç’°å¢ƒï¼ˆåŒ…å« Gatewayï¼‰
./script/cluster-up.sh

# ç¢ºèª Gateway å¯è¨ªå•
curl http://localhost:12345/actuator/health
```

### 2. å•Ÿå‹•å‰ç«¯é–‹ç™¼æœå‹™å™¨

```bash
cd web/exchange-web
npm run dev
```

è¨ªå• http://localhost:5173

### 3. æ¸¬è©¦æµç¨‹

1. **è¨»å†Š** - è¨ªå• http://localhost:5173/register
    - è¼¸å…¥ä¿¡ç®±å’Œå¯†ç¢¼
    - é»æ“Šè¨»å†Š

2. **ç™»å…¥** - è‡ªå‹•è·³è½‰åˆ°ç™»å…¥é æˆ–æ‰‹å‹•è¨ªå• /login
    - è¼¸å…¥å‰›æ‰è¨»å†Šçš„ä¿¡ç®±å¯†ç¢¼
    - é»æ“Šç™»å…¥

3. **äº¤æ˜“** - ç™»å…¥æˆåŠŸå¾Œè·³è½‰åˆ° /trading
    - é¸æ“‡è²·å…¥/è³£å‡º
    - é¸æ“‡é™åƒ¹/å¸‚åƒ¹
    - è¼¸å…¥åƒ¹æ ¼å’Œæ•¸é‡
    - é»æ“Šä¸‹å–®

## å¸¸è¦‹å•é¡Œ

### 1. API è«‹æ±‚å¤±æ•— CORS éŒ¯èª¤

éœ€è¦åœ¨å¾Œç«¯ Gateway é…ç½® CORSï¼š

```yaml
# åœ¨ application.yaml ä¸­æ·»åŠ 
spring:
  cloud:
    gateway:
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "http://localhost:5173"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: true
```

### 2. Token éæœŸå¾Œå¦‚ä½•è™•ç†

åœ¨ `client.ts` çš„æ””æˆªå™¨ä¸­å·²ç¶“è™•ç†ï¼šæ”¶åˆ° 401 è‡ªå‹•è·³è½‰åˆ°ç™»å…¥é ã€‚

### 3. å¦‚ä½•æŸ¥çœ‹ç¶²çµ¡è«‹æ±‚

åœ¨ç€è¦½å™¨æŒ‰ F12 æ‰“é–‹é–‹ç™¼è€…å·¥å…· â†’ Network æ¨™ç±¤é ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰ HTTP è«‹æ±‚ã€‚

### 4. å¦‚ä½•èª¿è©¦ä»£ç¢¼

- åœ¨ä»£ç¢¼ä¸­æ·»åŠ  `console.log('è®Šæ•¸å', è®Šæ•¸å€¼)`
- åœ¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·çš„ Console æ¨™ç±¤æŸ¥çœ‹è¼¸å‡º
- æˆ–åœ¨ä»£ç¢¼ä¸­æ·»åŠ  `debugger;` æš«åœåŸ·è¡Œ

## ä¸‹ä¸€æ­¥æ“´å±•

ç•¶åŸºæœ¬æµç¨‹è·‘é€šå¾Œï¼Œå¯ä»¥ä¾æ¬¡æ·»åŠ ï¼š

1. **è¨‚å–®åˆ—è¡¨é ** - é¡¯ç¤ºç•¶å‰ä½¿ç”¨è€…çš„è¨‚å–®
2. **WebSocket å¯¦æ™‚è¡Œæƒ…** - æ›¿æ›æ¨¡æ“¬çš„è¡Œæƒ…æ•¸æ“š
3. **è¨‚å–®ç°¿å±•ç¤º** - é¡¯ç¤ºè²·è³£ç›¤æ·±åº¦
4. **è³‡ç”¢æŸ¥è©¢** - æŸ¥è©¢å¸³æˆ¶é¤˜é¡
5. **ç°¡å–®åœ–è¡¨** - ä½¿ç”¨ Chart.js é¡¯ç¤º K ç·šåœ–

## å­¸ç¿’è³‡æº

- [React å®˜æ–¹æ–‡æª”](https://react.dev/)
- [Ant Design çµ„ä»¶æ–‡æª”](https://ant.design/components/overview-cn/)
- [Axios ä½¿ç”¨æŒ‡å—](https://axios-http.com/docs/intro)
- [TypeScript å…¥é–€æ•™ç¨‹](https://www.typescriptlang.org/docs/handbook/intro.html)

## ç¸½çµ

é€™æ˜¯ä¸€å€‹æœ€å°åŒ–çš„å‰ç«¯å°ˆæ¡ˆï¼ŒåªåŒ…å«æ ¸å¿ƒåŠŸèƒ½ï¼š

- âœ… è¨»å†Š / ç™»å…¥
- âœ… ä¸‹å–®è¡¨å–®
- âœ… ç°¡å–®çš„è¡Œæƒ…å±•ç¤º
- âœ… è·¯ç”±è·³è½‰
- âœ… Token ç®¡ç†

ä»£ç¢¼ç°¡å–®æ˜“æ‡‚ï¼Œé©åˆå‰ç«¯æ–°æ‰‹å­¸ç¿’å’Œæ“´å±•ã€‚å…ˆæŠŠé€™å€‹åŸºç¤ç‰ˆæœ¬è·‘èµ·ä¾†ï¼Œå†é€æ­¥æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼
